{% extends 'base.html' %}
{% block content %}

<h1>あなたの情報を入力</h1>
<p class="small">希望する条件を選択し、自己PRを自由記述してください。AIが内容を総合的に解析し、最適な求人を推薦します。</p>

<div class="card">
  <form id="match-form">
    <div style="display: flex; flex-direction: column; gap: 20px;">
      
      <div class="row">
        <div>
          <label for="location" class="small">希望勤務地</label>
          <select id="location" class="input">
            <option value="">指定しない</option>
            <option value="東京">東京</option>
            <option value="大阪">大阪</option>
            <option value="リモート">リモート</option>
            <option value="福岡">福岡</option>
            <option value="神奈川">神奈川</option>
            <option value="北海道">北海道</option>
          </select>
        </div>
        <div>
          <label for="sector" class="small">希望業種</label>
          <select id="sector" class="input">
            <option value="">指定しない</option>
            <option value="IT">IT</option>
            <option value="飲食">飲食</option>
            <option value="販売">販売</option>
            <option value="介護">介護</option>
            <option value="事務">事務</option>
          </select>
        </div>
      </div>
      <div>
        <label class="small">希望条件</label>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px;">
          <label><input type="checkbox" name="conditions" value="未経験歓迎"> 未経験歓迎</label>
          <label><input type="checkbox" name="conditions" value="年間休日120日以上"> 年間休日120日以上</label>
          <label><input type="checkbox" name="conditions" value="キャリアアップ"> キャリアアップ</label>
          <label><input type="checkbox" name="conditions" value="土日祝休み"> 土日祝休み</label>
        </div>
      </div>
      
      <div>
        <label for="my-profile-text" class="small">自己PR・経歴・スキルなど (自由記述)</label>
        <textarea id="my-profile-text" class="input" rows="8" placeholder="例：3年間、飲食店のホールスタッフとして接客経験を積みました。基本的なPC操作も可能です。"></textarea>
      </div>
      
      <div style="text-align: right;">
        <button type="submit" id="my-match-btn" class="btn">AIマッチング実行</button>
      </div>
    </div>
  </form>
</div>

<div class="card">
  <div id="my-match-result" class="small">ここにマッチング結果が表示されます。</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  const matchForm = document.getElementById('match-form');
  const locationSelect = document.getElementById('location');
  const sectorSelect = document.getElementById('sector');
  const profileInput = document.getElementById('my-profile-text');
  const resultArea = document.getElementById('my-match-result');

  matchForm.addEventListener('submit', function(event) {
    event.preventDefault(); 
    
    // ▼▼▼ 選択された条件と自由記述テキストを取得 ▼▼▼
    const selectedConditions = Array.from(document.querySelectorAll('input[name="conditions"]:checked')).map(cb => cb.value);
    
    const requestData = {
      location: locationSelect.value,
      sector: sectorSelect.value,
      conditions: selectedConditions,
      profile_text: profileInput.value
    };
    
    resultArea.textContent = 'AIが解析中...';

    // バックエンドにデータを送信
    fetch('/api/match/ad_hoc', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestData),
    })
    .then(response => response.ok ? response.json() : Promise.reject(response))
    .then(data => {
      renderResults(data.results || []);
    })
    .catch(error => {
      // ... (エラー処理は変更なし) ...
    });
  });

  // ... (renderResults関数は変更なし) ...
  function renderResults(results) { /* ... */ }
});
</script>

{% endblock %}